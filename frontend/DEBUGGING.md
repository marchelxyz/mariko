# Диагностика проблем с подключением к бекенду

## Проблема: Данные не загружаются

Если приложение не загружает данные (баннеры, рестораны, меню, профиль), выполните следующие шаги диагностики:

## 1. Проверка переменных окружения

### В Vercel:
1. Откройте проект в Vercel
2. Перейдите в **Settings** → **Environment Variables**
3. Убедитесь, что переменная `NEXT_PUBLIC_API_URL` установлена и имеет правильное значение
4. Значение должно быть URL вашего бекенда на Railway, например: `https://your-backend.railway.app/api`

### Важно:
- Переменная должна быть установлена **до** сборки проекта
- После изменения переменных окружения нужно **пересобрать** проект (Redeploy)

## 2. Проверка логов в браузере

Откройте консоль браузера (F12) и проверьте:

### Успешные запросы:
```
✅ API GET /banners - 200
✅ API GET /restaurants - 200
```

### Ошибки подключения:
```
❌ API Request Error: No response received
   code: ECONNREFUSED
```
**Решение**: Проверьте, что бекенд запущен и доступен по указанному URL

### Ошибки CORS:
```
❌ API Error Response: 403
   CORS policy blocked
```
**Решение**: Проверьте настройки CORS на бекенде, убедитесь, что домен фронтенда добавлен в разрешенные origins

### Ошибки таймаута:
```
❌ API Request Error: No response received
   code: ETIMEDOUT
```
**Решение**: Проверьте доступность бекенда, возможно проблема с сетью

## 3. Проверка логов на сервере (Vercel)

В Vercel перейдите в **Deployments** → выберите последний деплой → **Functions** → откройте логи

Ищите сообщения:
```
[getServerSideProps] API Base URL: ...
[getServerSideProps] NEXT_PUBLIC_API_URL: ...
```

Если видите `не установлена` - переменная окружения не доступна на сервере.

## 4. Проверка бекенда

### Health Check:
Откройте в браузере: `https://your-backend.railway.app/health`

Должен вернуться JSON с информацией о статусе:
```json
{
  "status": "ok",
  "database": { "status": "connected" },
  "redis": { "status": "connected" }
}
```

### Проверка API:
Попробуйте открыть: `https://your-backend.railway.app/api/restaurants`

Должен вернуться список ресторанов.

## 5. Частые проблемы и решения

### Проблема: Переменная установлена, но не работает

**Причина**: Next.js требует пересборки проекта после изменения переменных окружения.

**Решение**:
1. Убедитесь, что переменная установлена для нужного окружения (Production/Preview/Development)
2. Сделайте Redeploy проекта в Vercel
3. Или сделайте новый коммит и пуш - Vercel автоматически пересоберет проект

### Проблема: Работает локально, но не работает в production

**Причина**: Переменная окружения не установлена в Vercel или установлена неправильно.

**Решение**:
1. Проверьте значение переменной в Vercel
2. Убедитесь, что URL заканчивается на `/api` или не заканчивается на `/` (код автоматически добавит `/api`)
3. Пересоберите проект

### Проблема: CORS ошибки

**Причина**: Домен фронтенда не добавлен в разрешенные origins на бекенде.

**Решение**:
1. Проверьте переменную `FRONTEND_URL` на бекенде (Railway)
2. Убедитесь, что она содержит правильный URL фронтенда
3. Бекенд автоматически разрешает все домены `*.vercel.app`, но если используется кастомный домен, его нужно добавить

### Проблема: Таймауты

**Причина**: Бекенд медленно отвечает или недоступен.

**Решение**:
1. Проверьте логи бекенда на Railway
2. Убедитесь, что база данных подключена
3. Проверьте, что бекенд не перегружен

## 6. Дополнительная диагностика

### Проверка URL в коде:
В консоли браузера выполните:
```javascript
console.log('API URL:', process.env.NEXT_PUBLIC_API_URL);
```

Если выводит `undefined` - переменная не установлена или проект не пересобран.

### Проверка запросов в Network:
1. Откройте DevTools (F12)
2. Перейдите на вкладку **Network**
3. Обновите страницу
4. Найдите запросы к API
5. Проверьте:
   - **Request URL** - правильный ли URL?
   - **Status** - какой статус ответа?
   - **Response** - что вернул сервер?

## 7. Контакты для помощи

Если проблема не решена:
1. Соберите логи из консоли браузера
2. Соберите логи из Vercel Functions
3. Проверьте логи бекенда на Railway
4. Убедитесь, что все переменные окружения установлены правильно
