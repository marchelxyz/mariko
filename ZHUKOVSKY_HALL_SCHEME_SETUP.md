# Настройка схемы зала для ресторана в Жуковском

## Описание

Этот документ описывает, как использовать схему зала из виджета ReMarked для ресторана в Жуковском.

## Что мы знаем

Из HTML виджета ReMarked мы извлекли:
- **Point ID**: `203003` - ID точки в системе ReMarked
- **Фоновое изображение**: `https://access.clientomer.ru/widget/203003/bg1.png`
- **Логотип**: `https://access.clientomer.ru/widget/203003/logo.png`

## Как использовать схему зала

### Вариант 1: Автоматическая настройка через скрипт

Скрипт автоматически:
1. Найдет ресторан в Жуковском
2. Установит Point ID `203003` если его нет
3. Получит данные о столах через ReMarked API
4. Применит схему зала с фоновым изображением

```bash
cd backend
npm run setup-zhukovsky-hall
```

### Вариант 2: Через API синхронизации

Если ресторан уже имеет `remarkedPointId = 203003`, можно использовать API:

```bash
# Найти ID ресторана в Жуковском
# Затем выполнить синхронизацию:
curl -X POST "http://localhost:3000/api/restaurants/{restaurantId}/sync-hall-schemes?date=2024-12-20&guests_count=2"
```

### Вариант 3: Ручная настройка через админ-панель

1. Перейдите в админ-панель → Рестораны
2. Найдите ресторан в Жуковском
3. Установите `remarkedPointId = 203003`
4. Используйте функцию синхронизации схем залов
5. При необходимости отредактируйте координаты столов вручную

## Что будет создано

После выполнения скрипта или синхронизации:

```json
{
  "hallSchemes": [
    {
      "roomId": "1",
      "roomName": "Основной зал",
      "imageUrl": "https://access.clientomer.ru/widget/203003/bg1.png",
      "tables": [
        {
          "tableId": 330,
          "tableNumber": "330",
          "x": 10,
          "y": 10,
          "shape": "circle",
          "width": 40,
          "height": 40
        }
        // ... другие столы
      ]
    }
  ]
}
```

## Важные замечания

1. **Координаты столов**: При автоматической синхронизации координаты устанавливаются временно. Для точной настройки их нужно отредактировать вручную через админ-панель или напрямую в базе данных.

2. **Фоновое изображение**: Используется изображение из виджета ReMarked. Убедитесь, что оно доступно и загружается корректно.

3. **ID столов**: ID столов (`tableId`) должны совпадать с ID из ReMarked API для корректной работы бронирования.

4. **Вместимость столов**: Вместимость (`capacity`) может быть получена из API, если доступна. В противном случае можно указать вручную.

## Проверка результата

После настройки схемы зала:

1. Откройте страницу бронирования для ресторана в Жуковском
2. Выберите дату и время
3. Должна отобразиться схема зала с фоновым изображением
4. Столы должны быть видны на схеме

## Обновление координат столов

Если нужно обновить координаты столов:

### Через SQL:
```sql
UPDATE restaurants 
SET "hallSchemes" = jsonb_set(
  "hallSchemes",
  '{0,tables,0,x}',
  '25'
)
WHERE "remarkedPointId" = 203003;
```

### Через API (если реализован endpoint для обновления):
```bash
PUT /api/restaurants/{id}
{
  "hallSchemes": [...]
}
```

## Дополнительная информация

- См. `HALL_SCHEMES_SETUP.md` для подробной информации о структуре схем залов
- См. `EXTRACT_HALL_SCHEME.md` для информации об извлечении данных из виджетов
- См. `TABLE_BUNDLES_FEATURE.md` для работы с комбинациями столов
