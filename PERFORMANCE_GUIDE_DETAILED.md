# –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## 1. –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ë–î - —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º?

### –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π?

**–ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (Connection Pool)** - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–µ—Ç –∏ —Ö—Ä–∞–Ω–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

### –ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ –∂–∏–∑–Ω–∏

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω:
- **–ë–µ–∑ –ø—É–ª–∞**: –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –∂–¥–µ—Ç, –ø–æ–∫–∞ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –ø–æ–π–¥–µ—Ç –Ω–∞ –∫—É—Ö–Ω—é, –Ω–∞–π–¥–µ—Ç –ø–æ–≤–∞—Ä–∞, –ø–µ—Ä–µ–¥–∞—Å—Ç –∑–∞–∫–∞–∑, –≤–µ—Ä–Ω–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ. –≠—Ç–æ –¥–æ–ª–≥–æ!
- **–° –ø—É–ª–æ–º**: –í —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ –∫—É—Ö–Ω–µ. –ö–ª–∏–µ–Ω—Ç —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ, –Ω–µ –∂–¥–µ—Ç.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

#### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è (–±–µ–∑ –ø—É–ª–∞, —É–ø—Ä–æ—â–µ–Ω–Ω–æ):

```typescript
// –ü–ª–æ—Ö–æ: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
async function getRestaurants() {
  const connection = await createNewConnection(); // –ú–µ–¥–ª–µ–Ω–Ω–æ! 50-200ms
  const restaurants = await connection.query('SELECT * FROM restaurants');
  await connection.close(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
  return restaurants;
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç 50-200ms
- –ü—Ä–∏ 100 –∑–∞–ø—Ä–æ—Å–∞—Ö = 5-20 —Å–µ–∫—É–Ω–¥ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π!
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

#### –° –ø—É–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:

```typescript
// –•–æ—Ä–æ—à–æ: –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ –ø—É–ª–∞
const pool = createConnectionPool({ max: 10 }); // –°–æ–∑–¥–∞–µ–º 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∑–∞—Ä–∞–Ω–µ–µ

async function getRestaurants() {
  const connection = await pool.getConnection(); // –ë—ã—Å—Ç—Ä–æ! 1-5ms (–±–µ—Ä–µ–º –∏–∑ –ø—É–ª–∞)
  const restaurants = await connection.query('SELECT * FROM restaurants');
  pool.releaseConnection(connection); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –ø—É–ª, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º!
  return restaurants;
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑ –ø—É–ª–∞: 1-5ms (–≤ 10-50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –ø—É–ª–∞

```
–ë–µ–∑ –ø—É–ª–∞ (–ø–ª–æ—Ö–æ):
–ó–∞–ø—Ä–æ—Å 1 ‚Üí –°–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (200ms) ‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –ó–∞–∫—Ä—ã—Ç—å ‚Üí –ò—Ç–æ–≥–æ: 250ms
–ó–∞–ø—Ä–æ—Å 2 ‚Üí –°–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (200ms) ‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –ó–∞–∫—Ä—ã—Ç—å ‚Üí –ò—Ç–æ–≥–æ: 250ms
–ó–∞–ø—Ä–æ—Å 3 ‚Üí –°–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (200ms) ‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –ó–∞–∫—Ä—ã—Ç—å ‚Üí –ò—Ç–æ–≥–æ: 250ms
...
–ó–∞–ø—Ä–æ—Å 10 ‚Üí –í—Å–µ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞! –û–±—â–µ–µ –≤—Ä–µ–º—è: 2500ms

–° –ø—É–ª–æ–º –∏–∑ 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (—Ö–æ—Ä–æ—à–æ):
–ü—É–ª: [–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ1, –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ2, ..., –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ10] ‚Üê –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ

–ó–∞–ø—Ä–æ—Å 1 ‚Üí –í–∑—è—Ç—å –∏–∑ –ø—É–ª–∞ (1ms) ‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –í–µ—Ä–Ω—É—Ç—å –≤ –ø—É–ª ‚Üí –ò—Ç–æ–≥–æ: 51ms
–ó–∞–ø—Ä–æ—Å 2 ‚Üí –í–∑—è—Ç—å –∏–∑ –ø—É–ª–∞ (1ms) ‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –í–µ—Ä–Ω—É—Ç—å –≤ –ø—É–ª ‚Üí –ò—Ç–æ–≥–æ: 51ms
...
–ó–∞–ø—Ä–æ—Å 10 ‚Üí –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ! –û–±—â–µ–µ –≤—Ä–µ–º—è: ~51ms (–≤ 50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)
```

### –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ –≤–∞—à–µ–º –∫–æ–¥–µ

TypeORM –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—É–ª –∏–∑ **10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç:

```typescript
// –í –≤–∞—à–µ–º database.ts
export const AppDataSource = new DataSource({
  type: 'postgres',
  // ... –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  // –ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ—Ç —è–≤–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞!
  // TypeORM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ:**

```
–ó–∞–ø—Ä–æ—Å 1-10: ‚úÖ –ë–µ—Ä—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑ –ø—É–ª–∞, —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ
–ó–∞–ø—Ä–æ—Å 11: ‚è≥ –ñ–¥–µ—Ç, –ø–æ–∫–∞ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –æ–¥–Ω–æ –∏–∑ 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
–ó–∞–ø—Ä–æ—Å 12: ‚è≥ –ñ–¥–µ—Ç...
–ó–∞–ø—Ä–æ—Å 13: ‚è≥ –ñ–¥–µ—Ç...
...
–ó–∞–ø—Ä–æ—Å 100: ‚è≥ –ñ–¥–µ—Ç –æ—á–µ–Ω—å –¥–æ–ª–≥–æ! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.
```

### –†–µ—à–µ–Ω–∏–µ: –£–≤–µ–ª–∏—á–∏—Ç—å –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

#### –î–ª—è –±–∞–∑–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞ (Starter):

```typescript
// backend/src/config/database.ts
export const AppDataSource = new DataSource({
  type: 'postgres',
  host: dbConfig.host,
  port: dbConfig.port,
  username: dbConfig.username,
  password: dbConfig.password,
  database: dbConfig.database,
  entities: [User, Restaurant, MenuItem, Banner, DishImage],
  synchronize: true,
  logging: process.env.NODE_ENV === 'development',
  ssl: process.env.DB_SSL === 'true' || process.env.DATABASE_URL ? { rejectUnauthorized: false } : false,
  
  // ‚úÖ –î–û–ë–ê–í–ò–¢–¨ –≠–¢–ò –ù–ê–°–¢–†–û–ô–ö–ò:
  extra: {
    max: 30, // –ú–∞–∫—Å–∏–º—É–º 30 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ø—É–ª–µ (–¥–ª—è Starter –ø–ª–∞–Ω–∞)
    min: 5,  // –ú–∏–Ω–∏–º—É–º 5 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (—Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
    idleTimeoutMillis: 30000, // –ó–∞–∫—Ä—ã—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
    connectionTimeoutMillis: 2000, // –¢–∞–π–º–∞—É—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑ –ø—É–ª–∞
  },
});
```

#### –î–ª—è Pro –ø–ª–∞–Ω–∞:

```typescript
// backend/src/config/database.ts
export const AppDataSource = new DataSource({
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  
  extra: {
    max: 100, // ‚úÖ Pro –ø–ª–∞–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ 200-500 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º 100
    min: 10,  // –°–æ–∑–¥–∞–µ–º 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    idleTimeoutMillis: 30000,
    connectionTimeoutMillis: 2000,
  },
});
```

### –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞?

**–§–æ—Ä–º—É–ª–∞ (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è):**
```
–†–∞–∑–º–µ—Ä –ø—É–ª–∞ = –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ √ó –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ / –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞
```

**–ü—Ä–∏–º–µ—Ä—ã:**

1. **–ë–∞–∑–æ–≤—ã–π –ø–ª–∞–Ω:**
   - –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: ~50
   - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: 100ms
   - –†–∞–∑–º–µ—Ä –ø—É–ª–∞: 50 √ó 0.1 / 1 = **~30 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** ‚úÖ

2. **Pro –ø–ª–∞–Ω (–æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å):**
   - –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: ~500
   - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: 100ms
   - –†–∞–∑–º–µ—Ä –ø—É–ª–∞: 500 √ó 0.1 / 1 = **~50-100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** ‚úÖ

3. **Pro –ø–ª–∞–Ω (4 –∏–Ω—Å—Ç–∞–Ω—Å–∞):**
   - –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: ~2000
   - –ù–∞ –∫–∞–∂–¥—ã–π –∏–Ω—Å—Ç–∞–Ω—Å: 2000 / 4 = 500
   - –†–∞–∑–º–µ—Ä –ø—É–ª–∞ –Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Å: **50-100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** ‚úÖ
   - –û–±—â–∏–π –ø—É–ª: 4 √ó 100 = **400 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞ Pro –ø–ª–∞–Ω–∞)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—É–ª–∞

–î–æ–±–∞–≤—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –≤–∞—à –∫–æ–¥:

```typescript
// backend/src/config/database.ts
export const connectDatabase = async (): Promise<void> => {
  try {
    await AppDataSource.initialize();
    
    // ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    setInterval(() => {
      const pool = (AppDataSource.driver as any).master;
      if (pool) {
        console.log('üìä –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:', {
          total: pool.totalCount || 'N/A',
          idle: pool.idleCount || 'N/A',
          waiting: pool.waitingCount || 'N/A',
        });
      }
    }, 10000); // –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    
    console.log('‚úÖ PostgreSQL connected');
  } catch (error) {
    // ...
  }
};
```

---

## 2. Rate Limiting - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏

### –ß—Ç–æ —Ç–∞–∫–æ–µ Rate Limiting?

**Rate Limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤)** - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏.

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

#### –ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ Rate Limiting:

```typescript
// –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—ã—Å—è—á–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:
for (let i = 0; i < 10000; i++) {
  fetch('/api/menu/123'); // 10000 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Å–µ–∫—É–Ω–¥—É!
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// ‚ùå –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
// ‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞
// ‚ùå –ù–∞—Å—Ç–æ—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø
// ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç
```

#### –° Rate Limiting:

```typescript
// Rate Limiting: –º–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É —Å –æ–¥–Ω–æ–≥–æ IP
// –ó–∞–ø—Ä–æ—Å 1-100: ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
// –ó–∞–ø—Ä–æ—Å 101+: ‚ùå –ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π 429 "Too Many Requests"

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞—â–∏—â–µ–Ω
// ‚úÖ –ù–∞—Å—Ç–æ—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø
// ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Rate Limiting

#### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞

```bash
cd backend
npm install express-rate-limit
npm install --save-dev @types/express-rate-limit
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ middleware

```typescript
// backend/src/middleware/rateLimiter.ts
import rateLimit from 'express-rate-limit';

// ‚úÖ –û–±—â–∏–π rate limiter –¥–ª—è –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
export const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 100, // –ú–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 15 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP
  message: {
    success: false,
    error: {
      message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —ç—Ç–æ–≥–æ IP, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç',
    },
  },
  standardHeaders: true, // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–∞—Ö –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
  legacyHeaders: false,
});

// ‚úÖ –°—Ç—Ä–æ–≥–∏–π rate limiter –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
export const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 5, // –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –∑–∞ 15 –º–∏–Ω—É—Ç
  message: {
    success: false,
    error: {
      message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç',
    },
  },
  skipSuccessfulRequests: true, // –ù–µ —Å—á–∏—Ç–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
});

// ‚úÖ Rate limiter –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
export const writeLimiter = rateLimit({
  windowMs: 60 * 1000, // 1 –º–∏–Ω—É—Ç–∞
  max: 20, // –ú–∞–∫—Å–∏–º—É–º 20 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
  message: {
    success: false,
    error: {
      message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ',
    },
  },
});
```

#### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

```typescript
// backend/src/index.ts
import { apiLimiter, authLimiter, writeLimiter } from './middleware/rateLimiter';

// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

// ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—â–∏–π rate limiter –∫–æ –≤—Å–µ–º API –∑–∞–ø—Ä–æ—Å–∞–º
app.use('/api', apiLimiter);

// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

// Routes
app.use('/api/auth', authLimiter, authRoutes); // ‚úÖ –°—Ç—Ä–æ–≥–∏–π –ª–∏–º–∏—Ç –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
app.use('/api/restaurants', restaurantRoutes);
app.use('/api/menu', menuRoutes);
app.use('/api/banners', bannerRoutes);
app.use('/api/profile', profileRoutes);
app.use('/api/admin', writeLimiter, adminRoutes); // ‚úÖ –õ–∏–º–∏—Ç –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
app.use('/api/booking', writeLimiter, bookingRoutes); // ‚úÖ –õ–∏–º–∏—Ç –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
app.use('/api/dish-images', dishImageRoutes);
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

#### –ë–∞–∑–æ–≤—ã–π –ø–ª–∞–Ω (Starter):

```typescript
export const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 50, // –ú–µ–Ω—å—à–µ –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞
  // ...
});
```

#### Pro –ø–ª–∞–Ω:

```typescript
export const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 200, // –ë–æ–ª—å—à–µ –¥–ª—è Pro –ø–ª–∞–Ω–∞
  // ...
});
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞?

```typescript
// –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤:
GET /api/menu/123 ‚úÖ (–∑–∞–ø—Ä–æ—Å 1)
GET /api/menu/123 ‚úÖ (–∑–∞–ø—Ä–æ—Å 2)
...
GET /api/menu/123 ‚úÖ (–∑–∞–ø—Ä–æ—Å 100)
GET /api/menu/123 ‚ùå (–∑–∞–ø—Ä–æ—Å 101 - –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç!)

// –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:
HTTP/1.1 429 Too Many Requests
{
  "success": false,
  "error": {
    "message": "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —ç—Ç–æ–≥–æ IP, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç"
  }
}

// –í –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö:
X-RateLimit-Limit: 100        // –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤
X-RateLimit-Remaining: 0      // –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤
X-RateLimit-Reset: 1234567890 // –ö–æ–≥–¥–∞ –ª–∏–º–∏—Ç —Å–±—Ä–æ—Å–∏—Ç—Å—è
```

---

## 3. –ò–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω–¥–µ–∫—Å—ã?

**–ò–Ω–¥–µ–∫—Å** - —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ. –≠—Ç–æ –∫–∞–∫ –∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –≤ –∫–Ω–∏–≥–µ - –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã —á–∏—Ç–∞—Ç—å –≤—Å—é –∫–Ω–∏–≥—É, –≤—ã —Å—Ä–∞–∑—É –Ω–∞—Ö–æ–¥–∏—Ç–µ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.

### –ê–Ω–∞–ª–æ–≥–∏—è

**–ë–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ (–ø–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã):**
```
–¢–∞–±–ª–∏—Ü–∞ restaurants (1000 –∑–∞–ø–∏—Å–µ–π):
id | name      | city      | isActive
1  | –†–µ—Å—Ç–æ—Ä–∞–Ω1 | –ú–æ—Å–∫–≤–∞    | true
2  | –†–µ—Å—Ç–æ—Ä–∞–Ω2 | –°–ü–±       | false
3  | –†–µ—Å—Ç–æ—Ä–∞–Ω3 | –ú–æ—Å–∫–≤–∞    | true
...
1000 | –†–µ—Å—Ç–æ—Ä–∞–Ω1000 | –ú–æ—Å–∫–≤–∞ | true

–ó–∞–ø—Ä–æ—Å: SELECT * FROM restaurants WHERE isActive = true

–ë–î –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ö–ê–ñ–î–£–Æ —Å—Ç—Ä–æ–∫—É:
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä–æ–∫—É 1: isActive = true ‚Üí –ø–æ–¥—Ö–æ–¥–∏—Ç
‚ùå –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä–æ–∫—É 2: isActive = false ‚Üí –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä–æ–∫—É 3: isActive = true ‚Üí –ø–æ–¥—Ö–æ–¥–∏—Ç
...
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä–æ–∫—É 1000: isActive = true ‚Üí –ø–æ–¥—Ö–æ–¥–∏—Ç

–ò—Ç–æ–≥–æ: –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ 1000 —Å—Ç—Ä–æ–∫, –≤—Ä–µ–º—è: 50-100ms
```

**–° –∏–Ω–¥–µ–∫—Å–æ–º:**
```
–ò–Ω–¥–µ–∫—Å –ø–æ isActive:
isActive = false ‚Üí [2, 5, 10, ...] (—Å—Ç—Ä–æ–∫–∏ —Å false)
isActive = true  ‚Üí [1, 3, 4, 6, ...] (—Å—Ç—Ä–æ–∫–∏ —Å true)

–ó–∞–ø—Ä–æ—Å: SELECT * FROM restaurants WHERE isActive = true

–ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å:
‚úÖ –°—Ä–∞–∑—É –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å isActive = true: [1, 3, 4, 6, ...]
‚úÖ –ß–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏

–ò—Ç–æ–≥–æ: –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, –≤—Ä–µ–º—è: 5-10ms (–≤ 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)
```

### –ü—Ä–æ–±–ª–µ–º—ã –≤ –≤–∞—à–µ–º –∫–æ–¥–µ

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: Restaurant.isActive

```typescript
// backend/src/routes/restaurants.ts
const restaurants = await restaurantRepository.find({
  where: { isActive: true }, // ‚ùå –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞!
  order: { city: 'ASC', name: 'ASC' },
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ë–î —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –í–°–Æ —Ç–∞–±–ª–∏—Ü—É restaurants
- –ü—Ä–∏ 1000 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ
- –ü—Ä–∏ 10000 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö —ç—Ç–æ –û–ß–ï–ù–¨ –º–µ–¥–ª–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**

```typescript
// backend/src/models/Restaurant.ts
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  UpdateDateColumn,
  Index, // ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Index
} from 'typeorm';

@Entity('restaurants')
export class Restaurant {
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è ...

  @Column({ default: true })
  @Index() // ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ isActive
  isActive!: boolean;

  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è ...
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å 50-100ms –¥–æ 5-10ms
- –ü—Ä–∏ 10000 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö: —Å 500ms –¥–æ 20ms (–≤ 25 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: MenuItem.restaurantId + isAvailable

```typescript
// backend/src/routes/menu.ts
const menuItems = await menuItemRepository.find({
  where: { restaurantId, isAvailable: true }, // ‚ùå –ù–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞!
  order: { category: 'ASC', name: 'ASC' },
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ë–î –∏—â–µ—Ç –ø–æ restaurantId (–º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–¥–µ–∫—Å)
- –ó–∞—Ç–µ–º —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ isAvailable (–Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–∞)
- –ü—Ä–∏ 10000 –±–ª—é–¥ —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**

```typescript
// backend/src/models/MenuItem.ts
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  UpdateDateColumn,
  ManyToOne,
  JoinColumn,
  Index, // ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Index
} from 'typeorm';
import { Restaurant } from './Restaurant';

@Entity('menu_items')
@Index(['restaurantId', 'isAvailable']) // ‚úÖ –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å
export class MenuItem {
  @Column('uuid')
  restaurantId!: string;

  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è ...

  @Column({ default: true })
  isAvailable!: boolean;

  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è ...
}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å:**

```
–ò–Ω–¥–µ–∫—Å –ø–æ [restaurantId, isAvailable]:
restaurantId=1, isAvailable=true  ‚Üí [–±–ª—é–¥–æ1, –±–ª—é–¥–æ3, –±–ª—é–¥–æ5, ...]
restaurantId=1, isAvailable=false ‚Üí [–±–ª—é–¥–æ2, –±–ª—é–¥–æ4, ...]
restaurantId=2, isAvailable=true  ‚Üí [–±–ª—é–¥–æ10, –±–ª—é–¥–æ12, ...]
...

–ó–∞–ø—Ä–æ—Å: WHERE restaurantId = 1 AND isAvailable = true

–ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å:
‚úÖ –°—Ä–∞–∑—É –Ω–∞—Ö–æ–¥–∏—Ç: restaurantId=1, isAvailable=true ‚Üí [–±–ª—é–¥–æ1, –±–ª—é–¥–æ3, –±–ª—é–¥–æ5, ...]
‚úÖ –ß–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏

–í—Ä–µ–º—è: 5-10ms –≤–º–µ—Å—Ç–æ 100-200ms (–≤ 10-20 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)
```

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ –∏–Ω–¥–µ–∫—Å—ã?

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤, TypeORM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –∏—Ö –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ (–±–ª–∞–≥–æ–¥–∞—Ä—è `synchronize: true`).

–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ PostgreSQL:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü—ã restaurants
SELECT indexname, indexdef 
FROM pg_indexes 
WHERE tablename = 'restaurants';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü—ã menu_items
SELECT indexname, indexdef 
FROM pg_indexes 
WHERE tablename = 'menu_items';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ
EXPLAIN ANALYZE 
SELECT * FROM restaurants WHERE isActive = true;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞:**
```
Seq Scan on restaurants (cost=0.00..1000.00 rows=500 width=200)
  Filter: (isActive = true)
Planning Time: 0.1 ms
Execution Time: 50.123 ms
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Å –∏–Ω–¥–µ–∫—Å–æ–º:**
```
Index Scan using restaurants_isActive_idx on restaurants (cost=0.29..50.00 rows=500 width=200)
  Index Cond: (isAvailable = true)
Planning Time: 0.1 ms
Execution Time: 5.234 ms  ‚Üê –í 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!
```

---

## 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥?

–ë–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ:
- –°–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è?
- –ö–∞–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞?
- –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏?
- –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä?

### –ü—Ä–æ—Å—Ç–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
// backend/src/middleware/performanceMonitor.ts
import { Request, Response, NextFunction } from 'express';

interface PerformanceMetrics {
  count: number;
  totalTime: number;
  averageTime: number;
  minTime: number;
  maxTime: number;
  errors: number;
}

const metrics: Map<string, PerformanceMetrics> = new Map();

export const performanceMonitor = (
  req: Request,
  res: Response,
  next: NextFunction
): void => {
  const startTime = Date.now();
  const route = `${req.method} ${req.path}`;

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞
  if (!metrics.has(route)) {
    metrics.set(route, {
      count: 0,
      totalTime: 0,
      averageTime: 0,
      minTime: Infinity,
      maxTime: 0,
      errors: 0,
    });
  }

  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
  res.on('finish', () => {
    const duration = Date.now() - startTime;
    const routeMetrics = metrics.get(route)!;

    routeMetrics.count++;
    routeMetrics.totalTime += duration;
    routeMetrics.averageTime = routeMetrics.totalTime / routeMetrics.count;
    routeMetrics.minTime = Math.min(routeMetrics.minTime, duration);
    routeMetrics.maxTime = Math.max(routeMetrics.maxTime, duration);

    if (res.statusCode >= 400) {
      routeMetrics.errors++;
    }

    // –õ–æ–≥–∏—Ä—É–µ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    if (duration > 1000) {
      console.warn(`‚ö†Ô∏è  –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å: ${route} - ${duration}ms`);
    }
  });

  next();
};

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
export const getMetrics = () => {
  return Object.fromEntries(metrics);
};

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Å–±—Ä–æ—Å–∞ –º–µ—Ç—Ä–∏–∫
export const resetMetrics = () => {
  metrics.clear();
};
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

```typescript
// backend/src/index.ts
import { performanceMonitor, getMetrics, resetMetrics } from './middleware/performanceMonitor';

// ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º
app.use(performanceMonitor);

// ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ—Ç—Ä–∏–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
app.get('/api/admin/metrics', async (req, res) => {
  try {
    const metrics = getMetrics();
    res.json({
      success: true,
      data: metrics,
      timestamp: new Date().toISOString(),
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'Failed to get metrics',
    });
  }
});

// –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Å–±—Ä–æ—Å–∞ –º–µ—Ç—Ä–∏–∫
app.post('/api/admin/metrics/reset', async (req, res) => {
  try {
    resetMetrics();
    res.json({
      success: true,
      message: 'Metrics reset',
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'Failed to reset metrics',
    });
  }
});
```

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –º–µ—Ç—Ä–∏–∫

```json
{
  "success": true,
  "data": {
    "GET /api/restaurants": {
      "count": 1250,
      "totalTime": 62500,
      "averageTime": 50,
      "minTime": 15,
      "maxTime": 250,
      "errors": 2
    },
    "GET /api/menu/:restaurantId": {
      "count": 3420,
      "totalTime": 171000,
      "averageTime": 50,
      "minTime": 20,
      "maxTime": 500,
      "errors": 5
    },
    "POST /api/auth/telegram": {
      "count": 150,
      "totalTime": 15000,
      "averageTime": 100,
      "minTime": 50,
      "maxTime": 300,
      "errors": 0
    }
  },
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

---

## 5. –ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Railway (Pro –ø–ª–∞–Ω)

### –ß—Ç–æ —Ç–∞–∫–æ–µ –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ?

**–ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Railway Pro

```
–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∏–∑–∫–∞—è (50 req/s):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ò–Ω—Å—Ç–∞–Ω—Å 1  ‚îÇ ‚Üê –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ù–∞–≥—Ä—É–∑–∫–∞ –≤—ã—Ä–æ—Å–ª–∞ (500 req/s):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ò–Ω—Å—Ç–∞–Ω—Å 1  ‚îÇ ‚Üê Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ò–Ω—Å—Ç–∞–Ω—Å 2  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ò–Ω—Å—Ç–∞–Ω—Å 3  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ù–∞–≥—Ä—É–∑–∫–∞ —É–ø–∞–ª–∞ (50 req/s):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ò–Ω—Å—Ç–∞–Ω—Å 1  ‚îÇ ‚Üê Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     –ª–∏—à–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

–í Railway Dashboard:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–∏—Å–∞
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Scaling"
3. –í–∫–ª—é—á–∏—Ç–µ "Auto-scaling"
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **Min instances**: 1 (–º–∏–Ω–∏–º—É–º –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
   - **Max instances**: 4 (–º–∞–∫—Å–∏–º—É–º –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
   - **CPU threshold**: 70% (—Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–∏ 70% CPU)
   - **Memory threshold**: 80% (—Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–∏ 80% –ø–∞–º—è—Ç–∏)

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: PM2 –∫–ª–∞—Å—Ç–µ—Ä (–≤ –∫–æ–¥–µ)

```typescript
// backend/src/index.ts
import cluster from 'cluster';
import os from 'os';

const numCPUs = os.cpus().length;

if (cluster.isPrimary) {
  console.log(`Master ${process.pid} is running`);
  console.log(`Starting ${numCPUs} workers...`);

  // –°–æ–∑–¥–∞–µ–º –≤–æ—Ä–∫–µ—Ä—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ CPU)
  for (let i = 0; i < numCPUs; i++) {
    cluster.fork();
  }

  cluster.on('exit', (worker, code, signal) => {
    console.log(`Worker ${worker.process.pid} died. Restarting...`);
    cluster.fork(); // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —É–ø–∞–≤—à–∏–π –≤–æ—Ä–∫–µ—Ä
  });
} else {
  // –ö–æ–¥ –≤–æ—Ä–∫–µ—Ä–∞ (–≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥)
  const startServer = async () => {
    // ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ ...
  };

  startServer();
}
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ PM2 (–ø—Ä–æ—â–µ):**

```json
// backend/ecosystem.config.js
module.exports = {
  apps: [{
    name: 'mariko-backend',
    script: './dist/index.js',
    instances: 'max', // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ CPU —è–¥—Ä–∞
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
    },
    max_memory_restart: '1G', // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 1GB –ø–∞–º—è—Ç–∏
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
  }],
};
```

–ó–∞–ø—É—Å–∫:
```bash
npm run build
pm2 start ecosystem.config.js
```

---

## 6. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –æ—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ)

### –ß—Ç–æ —Ç–∞–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ?

**–ö—ç—à** - —ç—Ç–æ –±—ã—Å—Ç—Ä–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä–æ–µ —Ö—Ä–∞–Ω–∏—Ç —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–π —Ä–∞–∑.

### –ê–Ω–∞–ª–æ–≥–∏—è

**–ë–µ–∑ –∫—ç—à–∞:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1: "–î–∞–π –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ 1"
‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –û—Ç–≤–µ—Ç

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2: "–î–∞–π –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ 1"
‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –û—Ç–≤–µ—Ç (—Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ!)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 3: "–î–∞–π –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ 1"
‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –û—Ç–≤–µ—Ç (—Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ!)
```

**–° –∫—ç—à–µ–º:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1: "–î–∞–π –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ 1"
‚Üí –ó–∞–ø—Ä–æ—Å –∫ –ë–î (50ms) ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à ‚Üí –û—Ç–≤–µ—Ç

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2: "–î–∞–π –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ 1"
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à (1ms) ‚Üí –ù–∞–π–¥–µ–Ω–æ! ‚Üí –û—Ç–≤–µ—Ç (–≤ 50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 3: "–î–∞–π –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ 1"
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à (1ms) ‚Üí –ù–∞–π–¥–µ–Ω–æ! ‚Üí –û—Ç–≤–µ—Ç (–≤ 50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis –Ω–∞ Railway

1. –í Railway Dashboard –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
2. –í—ã–±–µ—Ä–∏—Ç–µ "Redis"
3. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç Redis –∏–Ω—Å—Ç–∞–Ω—Å
4. –ü–æ–ª—É—á–∏—Ç–µ `REDIS_URL` –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

#### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

```bash
cd backend
npm install ioredis
npm install --save-dev @types/ioredis
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ Redis –∫–ª–∏–µ–Ω—Ç–∞

```typescript
// backend/src/config/redis.ts
import Redis from 'ioredis';

let redis: Redis | null = null;

export const getRedisClient = (): Redis => {
  if (!redis) {
    const redisUrl = process.env.REDIS_URL || 'redis://localhost:6379';
    redis = new Redis(redisUrl, {
      maxRetriesPerRequest: 3,
      retryStrategy: (times) => {
        const delay = Math.min(times * 50, 2000);
        return delay;
      },
    });

    redis.on('error', (err) => {
      console.error('Redis Client Error:', err);
    });

    redis.on('connect', () => {
      console.log('‚úÖ Redis connected');
    });
  }

  return redis;
};

export const closeRedis = async (): Promise<void> => {
  if (redis) {
    await redis.quit();
    redis = null;
  }
};
```

#### –®–∞–≥ 3: Middleware –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
// backend/src/middleware/cache.ts
import { Request, Response, NextFunction } from 'express';
import { getRedisClient } from '../config/redis';

export const cache = (ttl: number = 300) => {
  return async (req: Request, res: Response, next: NextFunction) => {
    // –ö—ç—à–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ GET –∑–∞–ø—Ä–æ—Å—ã
    if (req.method !== 'GET') {
      return next();
    }

    try {
      const redis = getRedisClient();
      const cacheKey = `cache:${req.method}:${req.path}:${JSON.stringify(req.query)}`;
      
      // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫—ç—à–∞
      const cached = await redis.get(cacheKey);
      
      if (cached) {
        console.log(`‚úÖ Cache hit: ${cacheKey}`);
        return res.json(JSON.parse(cached));
      }

      // –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫—ç—à–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
      const originalJson = res.json.bind(res);
      res.json = function (body: any) {
        redis.setex(cacheKey, ttl, JSON.stringify(body))
          .catch(err => console.error('Redis set error:', err));
        return originalJson(body);
      };

      next();
    } catch (error) {
      console.error('Cache error:', error);
      // –ü—Ä–∏ –æ—à–∏–±–∫–µ –∫—ç—à–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∫—ç—à–∞
      next();
    }
  };
};
```

#### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫—ç—à–∞

```typescript
// backend/src/routes/restaurants.ts
import { Router, Request, Response } from 'express';
import { cache } from '../middleware/cache';
// ...

const router = Router();

// ‚úÖ –ö—ç—à–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –Ω–∞ 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥)
router.get('/', cache(3600), async (req: Request, res: Response) => {
  // ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
});

// ‚úÖ –ö—ç—à–∏—Ä—É–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –Ω–∞ 30 –º–∏–Ω—É—Ç (1800 —Å–µ–∫—É–Ω–¥)
router.get('/:id', cache(1800), async (req: Request, res: Response) => {
  // ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
});

export default router;
```

```typescript
// backend/src/routes/menu.ts
import { Router, Request, Response } from 'express';
import { cache } from '../middleware/cache';
// ...

const router = Router();

// ‚úÖ –ö—ç—à–∏—Ä—É–µ–º –º–µ–Ω—é –Ω–∞ 15 –º–∏–Ω—É—Ç (900 —Å–µ–∫—É–Ω–¥) - –º–µ–Ω—é –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è
router.get('/:restaurantId', cache(900), async (req: Request, res: Response) => {
  // ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
});

export default router;
```

#### –®–∞–≥ 5: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

```typescript
// backend/src/routes/menu.ts
import { getRedisClient } from '../config/redis';

// –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–µ–Ω—é (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–∫–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)
router.post('/:restaurantId/update', async (req: Request, res: Response) => {
  try {
    // ... –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –≤ –ë–î ...
    
    // ‚úÖ –£–¥–∞–ª—è–µ–º –∫—ç—à –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
    const redis = getRedisClient();
    const cacheKey = `cache:GET:/api/menu/${req.params.restaurantId}:{}`;
    await redis.del(cacheKey);
    
    res.json({ success: true });
  } catch (error) {
    // ...
  }
});
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–ë–µ–∑ –∫—ç—à–∞:**
- 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–Ω—é = 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –í—Ä–µ–º—è: 1000 √ó 50ms = 50 —Å–µ–∫—É–Ω–¥
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î: –≤—ã—Å–æ–∫–∞—è

**–° –∫—ç—à–µ–º:**
- 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–Ω—é = 1 –∑–∞–ø—Ä–æ—Å –∫ –ë–î + 999 –∏–∑ –∫—ç—à–∞
- –í—Ä–µ–º—è: 50ms + 999 √ó 1ms = ~1 —Å–µ–∫—É–Ω–¥–∞ (–≤ 50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å:

1. ‚úÖ **–ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ë–î** (5 –º–∏–Ω—É—Ç)
   - –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 30 (Starter) –∏–ª–∏ 100 (Pro)
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: +200-500 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

2. ‚úÖ **Rate Limiting** (15 –º–∏–Ω—É—Ç)
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS

3. ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã –ë–î** (10 –º–∏–Ω—É—Ç)
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ isActive –∏ [restaurantId, isAvailable]
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –∑–∞–ø—Ä–æ—Å—ã –≤ 10-20 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ

4. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (20 –º–∏–Ω—É—Ç)
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º

5. ‚≠ê **–ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** (Pro –ø–ª–∞–Ω, 10 –º–∏–Ω—É—Ç)
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Railway Dashboard
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: +2000-5000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

6. ‚≠ê **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Redis** (1 —á–∞—Å, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: +10000-20000 req/s –¥–ª—è –∫—ç—à–∏—Ä—É–µ–º—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

**–ë–∞–∑–æ–≤—ã–π –ø–ª–∞–Ω + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- 200-300 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- 200-400 req/s

**Pro –ø–ª–∞–Ω + –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- 2000-5000+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- 3000-8000+ req/s
- –° Redis: 10000-20000+ req/s –¥–ª—è –∫—ç—à–∏—Ä—É–µ–º—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
